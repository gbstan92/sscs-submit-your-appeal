#!groovy
import java.util.logging.Logger

Logger logger = Logger.getLogger("")

properties(
        [[$class: 'GithubProjectProperty', projectUrlStr: 'https://github.com/hmcts/submit-your-appeal'],
         pipelineTriggers([[$class: 'GitHubPushTrigger']])]
)

@Library("Infrastructure")

def product = "sscs-tribunals"
def component = "frontend"

withPipeline("nodejs", product, component) {
    after("smoketest:preview") {
        stage('Application URLs') {
            def AppDevUrl = env.TEST_URL.replace("https", "http")
            AppDevUrl = AppDevUrl.replace("-staging.", ".")
            println "Application URL: " + AppDevUrl
            println "Healthcheck URL: " + AppDevUrl + "/health"
            println "Kudu URL: " + AppDevUrl.replace(".service.", ".scm.service.")
        }
    }
    before('buildinfra:prod') {
        input "Would you like to continue to buildinfra:prod?"
    }
    after('buildinfra:preview') {
        logger.info ("I am doing buildinfra:preview")
        sh('yarn test:smoke')
    }
    after('deploy:preview') {
        logger.info ("I am doing deploy:preview")
    }
    after('smoketest:preview') {
        logger.info ("I am doing smoketest:preview")
    }
    after('smokeTest:preview') {
        logger.info ("I am doing smokeTest:preview")
    }
}
